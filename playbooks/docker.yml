---
- name: Install docker
  hosts: "{{ rke | default('rke') }}"
  pre_tasks:
    - name: Include collection variables
      ansible.builtin.include_vars:
        file: main.yml

    - name: Set install facts
      ansible.builtin.set_fact:
        docker_user: "{{ rke_install_user }}"

  tasks:
    - name: Disable active swap volume
      ansible.builtin.shell: swapoff -a
      tags: skip_ansible_lint
      become: true

    - name: Disable swap fstab entry
      ansible.builtin.lineinfile:
        state: absent
        path: /etc/fstab
        regexp: '^([^#].*?\sswap\s+sw\s+.*)$'
      become: true

    - name: Install Docker
      ansible.builtin.include_role:
        name: nephelaiio.rke.docker
        apply:
          become: true
      vars:
        docker_user_manage: true
